<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Taşınıyo çoook yakında!</title>
  <link rel="icon" type="image/x-icon" href="./assets/favicon.ico">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <link
    rel="stylesheet"
    type="text/css"
    href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/regular/style.css"
  />
  <link
    rel="stylesheet"
    type="text/css"
    href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/bold/style.css"
  />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Plus Jakarta Sans', Arial, sans-serif;
      background-color: #3C4CAB;
      margin: 0;
    }
    
    /* Uyarı stilleri */
    .field-error {
      border-color: #ef4444 !important;
      background-color: #fef2f2 !important;
      box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1) !important;
    }
    
    .field-error::placeholder {
      color: #dc2626 !important;
    }
    
    .error-message {
      color: #dc2626;
      font-size: 0.75rem;
      margin-top: 0.25rem;
      display: none;
    }
    
    .error-message.show {
      display: block;
    }
    
    .field-container {
      position: relative;
    }
    
    /* Number input spinner'ları gizle */
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    
    input[type="number"] {
      -moz-appearance: textfield;
      appearance: textfield;
    }
  </style>
</head>
<body>
  <div class="flex xl:flex-row flex-col lg:gap-24 gap-8 max-w-[90rem] px-5 pb-5 pt-8 md:pt-16 mx-auto w-full justify-between">
    <div class="flex justify-center items-center flex-col xl:block xl:text-left text-center">
      <img src="./assets/logo.webp" alt="Logo" class="md:h-10 h-10">
      <p class="text-[#FFCA28] text-lg font-semibold md:mt-40 mt-8 tracking-tight">#ensevilentasimacilikplatformu</p>
      <h1 class="text-white md:text-6xl text-3xl leading-[1.1] font-bold mt-2 tracking-tight">Aracınızı ve zamanınızı <br>gelire dönüştürün!</h1>
      <p class="text-white/80 md:text-lg text-xs my-6">
        Bu eşsiz fırsatı kaçırma! <br class="md:hidden">Taşınıyo'ya ilk katılan 100 sürücüden biri ol,<br> 3 ay boyunca yaptığın işlerin tamamını cebine koy!
      </p>
      <button id="scrollToForm" class="bg-[#FFCA28] py-3 px-6 text-center rounded-full text-black font-semibold my-6 xl:hidden">Ayrıcalıklı Sürücü Olmak İçin Başvur</button>
      <img src="./assets/brand.webp" alt="Brand" class="w-full mt-12 hidden md:block">
      <img src="./assets/brandMobile.webp" alt="Brand Mobile" class="w-full mt-8 md:hidden max-w-xl">
    </div>
    <div>
      <img src="./assets/opportunity.webp" alt="Opportunity" class="w-[34rem] opportunity mx-auto mt-8">
      <form id="driverForm" class="md:p-8 p-6 bg-white rounded-2xl mt-6 flex flex-col gap-3 w-[34rem] mx-auto max-w-full">
        <div class="flex gap-3">
          <div class="relative flex-1">
            <input
              type="text"
              name="first_name"
              placeholder="Ad"
              required
              class="border border-black/10 py-2.5 pl-10 pr-4 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-[#3C4CAB]"
            />
            <i class="ph ph-user text-xl absolute left-3 top-2.5"></i>
          </div>
          <div class="relative flex-1">
            <input
              type="text"
              name="last_name"
              placeholder="Soyad"
              required
              class="border border-black/10 py-2.5 pl-4 pr-4 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-[#3C4CAB]"
            />
          </div>
        </div>
        <div class="relative flex-1 field-container">
          <input
            type="email"
            name="email"
            placeholder="E-posta"
            required
            class="border border-black/10 py-2.5 pl-10 pr-4 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-[#3C4CAB]"
          />
          <i class="ph ph-at text-xl absolute left-3 top-2.5"></i>
          <div class="error-message">Geçerli bir e-posta adresi giriniz</div>
        </div>
        <div class="relative flex-1 field-container">
          <input
            type="number"
            name="phone"
            placeholder="Telefon (05XX XXX XXXX)"
            required
            class="border border-black/10 py-2.5 pl-10 pr-4 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-[#3C4CAB]"
          />
          <i class="ph ph-phone text-xl absolute left-3 top-2.5"></i>
          <div class="error-message">Geçerli bir telefon numarası giriniz (05XX XXX XXXX)</div>
        </div>
        <div class="mt-2">
          <span class="text-base mb-4 block text-gray-700">Araç Tipi Seçin</span>
          <div class="grid grid-cols-4 gap-3">
            <!-- Motosiklet -->
            <label class="relative cursor-pointer">
              <input type="radio" name="vehicle_type" value="motosiklet" class="sr-only peer" required>
              <div class="border-2 border-gray-200 rounded-xl pb-3 hover:border-[#3C4CAB] transition-colors peer-checked:border-[#3C4CAB] peer-checked:bg-[#3C4CAB]/5">
                <div class="flex flex-col items-center text-center">
                  <img src="./assets/car1.webp" alt="Motosiklet" class="w-20 h-20 object-contain -mb-2">
                  <span class="text-sm font-medium text-gray-700 peer-checked:text-[#3C4CAB]">Motosiklet</span>
                </div>
              </div>
            </label>
            
            <!-- Minivan -->
            <label class="relative cursor-pointer">
              <input type="radio" name="vehicle_type" value="minivan" class="sr-only peer" required>
              <div class="border-2 border-gray-200 rounded-xl pb-3 hover:border-[#3C4CAB] transition-colors peer-checked:border-[#3C4CAB] peer-checked:bg-[#3C4CAB]/5">
                <div class="flex flex-col items-center text-center">
                  <img src="./assets/car2.webp" alt="Minivan" class="w-20 h-20 object-contain -mb-2">
                  <span class="text-sm font-medium text-gray-700 peer-checked:text-[#3C4CAB]">Minivan</span>
                </div>
              </div>
            </label>
            
            <!-- Panelvan -->
            <label class="relative cursor-pointer">
              <input type="radio" name="vehicle_type" value="panelvan" class="sr-only peer" required>
              <div class="border-2 border-gray-200 rounded-xl pb-3 hover:border-[#3C4CAB] transition-colors peer-checked:border-[#3C4CAB] peer-checked:bg-[#3C4CAB]/5">
                <div class="flex flex-col items-center text-center">
                  <img src="./assets/car3.webp" alt="Panelvan" class="w-20 h-20 object-contain -mb-2">
                  <span class="text-sm font-medium text-gray-700 peer-checked:text-[#3C4CAB]">Panelvan</span>
                </div>
              </div>
            </label>
            
            <!-- Kamyonet -->
            <label class="relative cursor-pointer">
              <input type="radio" name="vehicle_type" value="kamyonet" class="sr-only peer" required>
              <div class="border-2 border-gray-200 rounded-xl pb-3 hover:border-[#3C4CAB] transition-colors peer-checked:border-[#3C4CAB] peer-checked:bg-[#3C4CAB]/5">
                <div class="flex flex-col items-center text-center">
                  <img src="./assets/car4.webp" alt="Kamyonet" class="w-20 h-20 object-contain -mb-2">
                  <span class="text-sm font-medium text-gray-700 peer-checked:text-[#3C4CAB]">Kamyonet</span>
                </div>
              </div>
            </label>
          </div>
        </div>
        
        <div class="flex flex-col mt-4 ml-3">
          <span class="text-base mb-3">Araç sahibi siz misiniz?</span>
          <div class="flex items-center gap-6">
            <label class="flex items-center gap-1.5 text-base text-gray-600">
              <input type="radio" name="consent" value="yes" id="consentYes" class="accent-[#3C4CAB]" />
              Evet
            </label>
            <label class="flex items-center gap-1.5 text-base text-gray-600">
              <input type="radio" name="consent" value="no" id="consentNo" class="accent-[#3C4CAB]" />
              Hayır
            </label>
          </div>
        </div>
        <!-- Honeypot ve anti-bot alanları -->
        <div class="sr-only" aria-hidden="true">
          <label for="website">Web sitesi</label>
          <input id="website" type="text" name="website" tabindex="-1" autocomplete="off">
        </div>
        <input type="hidden" name="form_started_at" value="">
        <input type="hidden" name="interaction_count" value="0">

        <button type="submit" disabled class="bg-[#3C4CAB] py-3 px-4 text-center rounded-lg text-white font-medium opacity-50 cursor-not-allowed transition-opacity mt-4">Ayrıcalıklı Sürücü Olmak İçin Başvur</button>
      </form>
    </div>

  </div>
  <script>
    const opportunity = document.querySelector('.opportunity');
  
    function shake() {
      opportunity.classList.add('animate__animated', 'animate__shakeX');
      setTimeout(() => {
        opportunity.classList.remove('animate__animated', 'animate__shakeX');
      }, 1000); // shake duration 1s
    }
  
    // Sayfa yüklenir yüklenmez hemen sallansın
    shake();
  
    // Daha sonra her 5 saniyede bir tekrarlansın
    setInterval(shake, 5000);

    // Üstteki butona tıklandığında forma scroll yap
    const scrollToFormButton = document.getElementById('scrollToForm');
    scrollToFormButton.addEventListener('click', () => {
      const form = document.getElementById('driverForm');
      form.scrollIntoView({ 
        behavior: 'smooth',
        block: 'center'
      });
    });

    // Form alanları ve submit butonu kontrolü
    const form = document.getElementById('driverForm');
    const submitButton = document.querySelector("button[type='submit']");
    const consentYes = document.getElementById("consentYes");
    const HONEYPOT_FIELD_NAME = 'website';
    let interactionCount = 0;

    // Form yüklenme zamanını işaretle
    if (form && form.form_started_at) {
      form.form_started_at.value = String(Date.now());
    }

    function markInteraction() {
      interactionCount += 1;
      if (form && form.interaction_count) {
        form.interaction_count.value = String(interactionCount);
      }
    }

    // Email doğrulama fonksiyonu
    function isValidEmail(email) {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return emailRegex.test(email);
    }

    // Telefon doğrulama fonksiyonu (Türkiye telefon numarası)
    function isValidPhone(phone) {
      // Türkiye telefon numarası formatları:
      // 05XX XXX XXXX (cep telefonu)
      // +90 5XX XXX XXXX (uluslararası format)
      // 5XX XXX XXXX (sadece numara)
      const phoneRegex = /^(\+90\s?)?(0?5\d{2}\s?\d{3}\s?\d{2}\s?\d{2})$/;
      return phoneRegex.test(phone.replace(/\s/g, ''));
    }

    // Uyarı göster/gizle fonksiyonları
    function showFieldError(fieldName, show = true) {
      const field = form[fieldName];
      const container = field.closest('.field-container');
      const errorMessage = container.querySelector('.error-message');
      
      if (show) {
        field.classList.add('field-error');
        errorMessage.classList.add('show');
      } else {
        field.classList.remove('field-error');
        errorMessage.classList.remove('show');
      }
    }

    function updateButtonState() {
      // Tüm zorunlu alanları kontrol et
      const firstName = form.first_name.value.trim();
      const lastName = form.last_name.value.trim();
      const email = form.email.value.trim();
      const phone = form.phone.value.trim();
      
      // Email ve telefon doğrulaması
      const emailValid = isValidEmail(email);
      const phoneValid = isValidPhone(phone);
      
      // Radio butonlardan seçili olanı bul
      const selectedVehicleType = document.querySelector('input[name="vehicle_type"]:checked');
      const vehicleType = selectedVehicleType ? selectedVehicleType.value : '';
      
      const consentYesChecked = consentYes.checked;
      const consentNoChecked = document.getElementById("consentNo").checked;

      // Tüm alanlar doldurulmuş, geçerli email/telefon ve "Evet" seçilmiş mi kontrol et
      const allFieldsFilled = firstName && lastName && email && phone && vehicleType && consentYesChecked;
      const validationPassed = emailValid && phoneValid;
      
      // "Hayır" seçilmişse veya hiçbir şey seçilmemişse buton pasif
      const consentValid = consentYesChecked && !consentNoChecked;

      if (allFieldsFilled && validationPassed && consentValid) {
        submitButton.disabled = false;
        submitButton.classList.remove("opacity-50", "cursor-not-allowed");
      } else {
        submitButton.disabled = true;
        submitButton.classList.add("opacity-50", "cursor-not-allowed");
      }
    }

    // Blur eventi için doğrulama fonksiyonu
    function validateFieldOnBlur(fieldName) {
      const field = form[fieldName];
      const value = field.value.trim();
      
      if (fieldName === 'email') {
        if (value && !isValidEmail(value)) {
          showFieldError('email', true);
        } else {
          showFieldError('email', false);
        }
      } else if (fieldName === 'phone') {
        if (value && !isValidPhone(value)) {
          showFieldError('phone', true);
        } else {
          showFieldError('phone', false);
        }
      }
    }

    // Tüm input alanlarına event listener ekle
    form.first_name.addEventListener("input", updateButtonState);
    form.last_name.addEventListener("input", updateButtonState);
    form.email.addEventListener("input", updateButtonState);
    form.phone.addEventListener("input", updateButtonState);
    // Etkileşim sayacı
    form.first_name.addEventListener("input", markInteraction);
    form.last_name.addEventListener("input", markInteraction);
    form.email.addEventListener("input", markInteraction);
    form.phone.addEventListener("input", markInteraction);
    form.addEventListener("focusin", markInteraction);
    
    // Email ve telefon için blur eventi ekle
    form.email.addEventListener("blur", () => validateFieldOnBlur('email'));
    form.phone.addEventListener("blur", () => validateFieldOnBlur('phone'));
    
    // Radio butonlar için event listener ekle
    const vehicleTypeRadios = document.querySelectorAll('input[name="vehicle_type"]');
    vehicleTypeRadios.forEach(radio => {
      radio.addEventListener("change", updateButtonState);
      radio.addEventListener("change", markInteraction);
    });
    
    consentYes.addEventListener("change", updateButtonState);
    document.getElementById("consentNo").addEventListener("change", updateButtonState);
    
    // İlk durum kontrolü
    updateButtonState();

    // Araç görselleri arasına rastgele boşluklar ekle
    function addRandomSpacing() {
      const carImages = document.querySelectorAll('.car-image');
      carImages.forEach((car, index) => {
        if (index > 0) { // İlk araçtan sonraki araçlar için
          // 10vw ile 30vw arasında rastgele boşluk
          const randomGap = Math.random() * 20 + 10;
          car.style.marginLeft = randomGap + 'vw';
        }
      });
    }

    // Sayfa yüklendiğinde rastgele boşlukları ekle
    addRandomSpacing();


    document.getElementById('driverForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const form = e.target;
      const submitButton = document.querySelector("button[type='submit']");

      // Anti-bot kontrolleri
      const hp = (form[HONEYPOT_FIELD_NAME] && form[HONEYPOT_FIELD_NAME].value || '').trim();
      const startedAt = Number(form.form_started_at && form.form_started_at.value || 0);
      const elapsedMs = Date.now() - startedAt;
      const minElapsedMs = 2500; // minimum 2.5 saniye
      const minInteractions = 3; // minimum etkileşim sayısı

      if (hp || elapsedMs < minElapsedMs || interactionCount < minInteractions) {
        // Spam şüphesi: gönderimi engelle
        submitButton.disabled = true;
        submitButton.textContent = 'Spam tespit edildi';
        submitButton.classList.remove("bg-[#3C4CAB]");
        submitButton.classList.add("bg-red-600", "opacity-50", "cursor-not-allowed");
        setTimeout(() => {
          submitButton.textContent = 'Gönder';
          submitButton.classList.remove("bg-red-600");
          submitButton.classList.add("bg-[#3C4CAB]");
          updateButtonState();
        }, 3000);
        return;
      }

      // Buton durumunu güncelle - gönderiliyor
      submitButton.disabled = true;
      submitButton.textContent = 'Gönderiliyor...';
      submitButton.classList.add("opacity-50", "cursor-not-allowed");

      const data = {
        first_name: form.first_name.value,
        last_name: form.last_name.value,
        email: form.email.value,
        phone: form.phone.value,
        vehicle_type: document.querySelector('input[name="vehicle_type"]:checked').value
      };

      try {
        const res = await fetch("https://jjaxfkmcihygbqixndqk.functions.supabase.co/tasiniyo-form", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        });

        console.log('Response status:', res.status);

        // 200-299 arası status kodları başarılı sayılır
        if (res.status >= 200 && res.status < 300) {
          // Başarılı durum
          submitButton.textContent = 'Gönderildi!';
          submitButton.classList.remove("bg-[#3C4CAB]");
          submitButton.classList.add("bg-green-600");

          // Formu temizle
          form.reset();

          // 3 saniye sonra normal duruma dön
          setTimeout(() => {
            submitButton.textContent = 'Gönder';
            submitButton.classList.remove("bg-green-600");
            submitButton.classList.add("bg-[#3C4CAB]");
            updateButtonState(); // Form durumunu kontrol et
          }, 3000);
        } else {
          // HTTP hatası
          const result = await res.json();
          console.error('HTTP Error:', result);
          throw new Error(`HTTP ${res.status}: ${result.message || 'Bilinmeyen hata'}`);
        }

      } catch (err) {
        console.error('Request failed:', err);

        // Başarısız durum
        submitButton.textContent = 'Gönderme Başarısız';
        submitButton.classList.remove("bg-[#3C4CAB]");
        submitButton.classList.add("bg-red-600");

        // 3 saniye sonra normal duruma dön
        setTimeout(() => {
          submitButton.textContent = 'Gönder';
          submitButton.classList.remove("bg-red-600");
          submitButton.classList.add("bg-[#3C4CAB]");
          updateButtonState(); // Form durumunu kontrol et
        }, 3000);
      }
    });
  </script>
</body>
</html>
